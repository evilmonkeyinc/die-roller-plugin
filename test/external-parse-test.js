/**
 * @file test/external-parse-test.js
 * @author scott.mcgowan@wisemonkeygames.com
 *
 * Generated by the converse-cli tool for use with the Converse AI
 * Plugins SDK. https://developers.converse.ai/
 */

const { describe, it } = require('mocha');
const request = require('supertest');
const { expect } = require('chai');
const { Status } = require('@converseai/plugins-sdk');
const server = require('./lib/express');
const appToken = require('../app-token');

describe('parse', () => {
  it('base', (done) => {
    request(server)
      .post('/')
      .send({
        event: 'EXTERNAL_CALL',
        payload: {
          call: 'parse',
          method: 'GET',
          queryParam: {
            expression: {
              data: ['2d20k1+5'],
            },
          },
          'Content-Type': 'application/json',
          registrationData: {
          },
        },
      })
      .set('X_CONVERSE_APP_TOKEN', appToken)
      .expect(200)
      .end((err, res) => {
        expect(res.body).to.have.property('status').to.equal(Status.SUCCESS);
        expect(res.body).to.have.property('externalCallReturn');
        expect(res.body.externalCallReturn).to.have.property('body').to.not.equal(undefined);
        expect(res.body.externalCallReturn).to.have.property('body').to.not.equal(null);
        expect(res.body.externalCallReturn).to.have.property('body').to.not.equal('');
        done();
      });
  });
});
